!function(e){function n(){mapControl.map=new google.maps.Map(document.getElementById("map"),{center:e.userLocation,zoom:14}),mapControl.bounds=new google.maps.LatLngBounds}function o(n,o,t){if(!this.currentMarkers.hasOwnProperty(n)){var r=this,a=new google.maps.LatLng(o.lat,o.lng),i=new google.maps.Marker({map:r.map,position:a});if(r.bounds.extend(a),t.categories&&t.categories.length>0){var s=t.categories[0].name.toLowerCase();s.indexOf("food")>=0||s.indexOf("restaurant")>=0?i.setIcon("./images/food.jpg"):s.indexOf("shop")>=0||s.indexOf("store")>=0?i.setIcon("./images/shop.png"):s.indexOf("hotel")>=0?i.setIcon("./images/hotel.png"):s.indexOf("hospital")>=0||s.indexOf("drugstore")>=0?i.setIcon("./images/hospital.png"):(s.indexOf("school")>=0||s.indexOf("university")>=0||s.indexOf("college")>=0)&&i.setIcon("./images/school.png")}i.props=t,i.addListener("click",function(){e.vm.activePlace(t.id),r._focusAndActiveMarker(i),$(".list-view").animate({scrollTop:$("#place-"+t.id).offset().top},2e3)}),r.currentMarkers[n]=i}}function t(e,n){if(!l())return void(self.center=o);var o=new google.maps.LatLng(e,n);this.map.setCenter(o)}function r(e){this._focusAndActiveMarker(this.currentMarkers[e])}function a(n){var o=this,t=n.getPosition();o.map.panTo(t),o.map.setZoom(18),o.currentActiveMarker&&o.currentActiveMarker.setAnimation(null),n.setAnimation(google.maps.Animation.BOUNCE),o.currentActiveMarker&&o.currentActiveMarker.setIcon(),n.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),o._setStreetView(t),o.currentActiveMarker=n,o.infowindow&&o.infowindow.close();var r=g+"&lat="+t.lat()+"&lon="+t.lng();e.fetchData(r,function(e){o._showPlaceInfo(e)})}function i(e){var n=this,o=n.currentActiveMarker.props,t=o.categories[0]?o.categories[0].name:"no-category",r=o.contact.hasOwnProperty("phone")?o.contact.phone:"no-phone",a="<h4>"+o.name+"</h4><p>Category："+t+"<br>Contact phone："+r+"<br></p>";e&&(a+="<h4>Weather</h4>",a+="<p>Temp："+e.main.temp+"<br>Humidity："+e.main.humidity+"<br>Pressure："+e.main.pressure+"<br></p>"),n.infowindow=new google.maps.InfoWindow({content:a}),n.infowindow.open(n.map,n.currentActiveMarker)}function s(e){if(mapControl.isGoogleMapLoad()){var n=this;for(var o in n.currentMarkers)n.currentMarkers[o].setVisible(!1);e.forEach(function(e){n.currentMarkers.hasOwnProperty(e.id())&&n.currentMarkers[e.id()].setVisible(!0)})}}function c(e){var n=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:{lat:e.lat(),lng:e.lng()},linksControl:!1,enableCloseButton:!1,panControl:!1});this.map.setStreetView(n)}function p(){alert("Google Map cannot be load！")}function l(){return"undefined"!=typeof google}var g="http://api.openweathermap.org/data/2.5/weather?appid=880bffc84e2e5b4832fadb69743c082e";e.mapControl={initMap:n,addMaker:o,setCenter:t,focusToMarkerById:r,filterMarkers:s,isGoogleMapLoad:l,_focusAndActiveMarker:a,_showPlaceInfo:i,_setStreetView:c,currentMarkers:{},currentActiveMarker:null,infowindow:null},e.initMap=n,e.handleMapError=p}(window,ko);