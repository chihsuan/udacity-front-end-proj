!function(e){function n(){mapControl.map=new google.maps.Map(document.getElementById("map"),{center:mapControl.center,zoom:14}),mapControl.bounds=new google.maps.LatLngBounds}function t(n,t,o){if(!this.currentMarkers.hasOwnProperty(n)){var r=this,a=new google.maps.LatLng(t.lat,t.lng),i=new google.maps.Marker({map:r.map,position:a});if(r.bounds.extend(a),o.categories&&o.categories.length>0){var s=o.categories[0].name.toLowerCase();s.indexOf("food")>=0||s.indexOf("restaurant")>=0?i.setIcon("./images/food.jpg"):s.indexOf("shop")>=0||s.indexOf("store")>=0?i.setIcon("./images/shop.png"):s.indexOf("hotel")>=0?i.setIcon("./images/hotel.png"):s.indexOf("hospital")>=0||s.indexOf("drugstore")>=0?i.setIcon("./images/hospital.png"):(s.indexOf("school")>=0||s.indexOf("university")>=0||s.indexOf("college")>=0)&&i.setIcon("./images/school.png")}i.props=o,i.addListener("click",function(){e.vm.activePlace(o.id),r._focusAndActiveMarker(i),$(".list-view").animate({scrollTop:$("#place-"+o.id).offset().top},2e3)}),r.currentMarkers[n]=i}}function o(e,n){if(!l())return void(self.center=t);var t=new google.maps.LatLng(e,n);this.map.setCenter(t)}function r(e){this._focusAndActiveMarker(this.currentMarkers[e])}function a(n){var t=this,o=n.getPosition();t.map.panTo(o),t.map.setZoom(18),t.currentActiveMarker&&t.currentActiveMarker.setAnimation(null),n.setAnimation(google.maps.Animation.BOUNCE),t.currentActiveMarker&&t.currentActiveMarker.setIcon(),n.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),t._setStreetView(o),t.currentActiveMarker=n,t.infowindow&&t.infowindow.close();var r=g+"&lat="+o.lat()+"&lon="+o.lng();e.fetchData(r,function(e){t._showPlaceInfo(e)})}function i(e){var n=this,t=n.currentActiveMarker.props,o=t.categories[0]?t.categories[0].name:"no-category",r=t.contact.hasOwnProperty("phone")?t.contact.phone:"no-phone",a="<h4>"+t.name+"</h4><p>Category："+o+"<br>Contact phone："+r+"<br></p>";e&&(a+="<h4>Weather</h4>",a+="<p>Temp："+e.main.temp+"<br>Humidity："+e.main.humidity+"<br>Pressure："+e.main.pressure+"<br></p>"),n.infowindow=new google.maps.InfoWindow({content:a}),n.infowindow.open(n.map,n.currentActiveMarker)}function s(e){if(mapControl.isGoogleMapLoad()){var n=this;for(var t in n.currentMarkers)n.currentMarkers[t].setVisible(!1);e.forEach(function(e){n.currentMarkers.hasOwnProperty(e.id())&&n.currentMarkers[e.id()].setVisible(!0)})}}function c(e){var n=new google.maps.StreetViewPanorama(document.getElementById("pano"),{position:{lat:e.lat(),lng:e.lng()},linksControl:!1,enableCloseButton:!1,panControl:!1});this.map.setStreetView(n)}function p(){alert("Google Map cannot be load！")}function l(){return"undefined"!=typeof google}var g="http://api.openweathermap.org/data/2.5/weather?appid=880bffc84e2e5b4832fadb69743c082e";e.mapControl={initMap:n,addMaker:t,setCenter:o,focusToMarkerById:r,filterMarkers:s,isGoogleMapLoad:l,_focusAndActiveMarker:a,_showPlaceInfo:i,_setStreetView:c,currentMarkers:{},currentActiveMarker:null,infowindow:null,center:{lat:23.6,lng:120.3}},e.initMap=n,e.handleMapError=p}(window,ko);