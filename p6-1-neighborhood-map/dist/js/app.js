!function(o,e){function t(o){this.id=e.observable(o.id),this.name=e.observable(o.name),this.contact=e.observable(o.contact),this.location=e.observable(o.location),this.categories=e.observable(o.categories);var t=o.categories[0]?o.categories[0].name:"";this.category=e.observable(t)}function a(){function a(o){var e={lat:o.coords.latitude,lng:o.coords.longitude},t=i+"&ll="+e.lat+","+e.lng;n(t,s)}function s(e){if(!e)return void u.status("Unable to connect to Foursquare...");if(!e.response||!e.response.venues||0===e.response.venues.length)return void u.status("Sorry, Foursquare has no your neighborhood data...");var a=e.response.venues,n=$.map(a,function(o){return mapControl.isGoogleMapLoad()?mapControl.addMaker(o.id,o.location,o):setTimeout(function(){mapControl.isGoogleMapLoad()&&mapControl.addMaker(o.id,o.location,o)},1e3),new t(o)});mapControl.map?mapControl.map.fitBounds(mapControl.bounds):setTimeout(function(){mapControl.map.fitBounds(mapControl.bounds)},1e3),u.places(n),u.status("Not Found..."),o.saveToLocalStorage("neighborhood-map",e)}function l(o){o.PERMISSION_DENIED||alert("Get current position failï¼"),r(a)}var u=this;u.status=e.observable("Loading..."),u.places=e.observableArray([]),u.toggleMenu=function(){u.displayMenu(u.displayMenu()?!1:!0)},u.displayMenu=e.observable(!0),u.activePlace=e.observable(""),u.showPlace=function(o){u.activePlace(o.id()),mapControl.focusToMarkerById(o.id())},u.filterInput=e.observable(""),u.categoryInput=e.observable(""),u.filter=function(){},u.filteredPlaces=e.computed(function(){var o=u.filterInput().toLowerCase().trim(),e=u.categoryInput().toLowerCase().trim();if(o||e){var t=u.places().filter(function(t){return o&&t.name().toLowerCase().indexOf(o)>=0||e&&t.category().toLowerCase().indexOf(e)>=0});return t=t?t:[],mapControl.filterMarkers(t),t}return mapControl.filterMarkers(u.places()),u.places()}),o.getLocalStorage("neighborhood-map",s),navigator.geolocation?navigator.geolocation.getCurrentPosition(a,l):r(a)}function n(o,e){$.getJSON(o,function(o){o||(o=[]),e(o)}).fail(function(){e(null)})}function r(o){o({coords:{latitude:40.7053111,longitude:-74.258188}})}var i="https://api.foursquare.com/v2/venues/search?oauth_token=EACTJOEC3DFI4G4FHBQILJ1WVA1ZASBOIE4E5SKCO04ACVBC&v=20160323";e.bindingHandlers.sidebarVisible={init:function(o,t){var a=t();$(o).toggle(e.unwrap(a))},update:function(o,t){var a=t();$(o).animate(e.unwrap(a)?{left:0}:{left:"-240px"})}},e.bindingHandlers.slideIcon={init:function(o,t){var a=t();$(o).toggle(e.unwrap(a))},update:function(o,t){var a=t();$(o).animate(e.unwrap(a)?{left:"240px"}:{left:0})}},o.fetchData=n,o.vm=new a,e.applyBindings(vm)}(window,ko);